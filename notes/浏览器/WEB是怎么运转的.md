# Web 是怎么运转的

当我们在浏览器中输入google.com时屏幕后面发生了什么。

## 当按下google中的‘g’键

当你按下‘g’键时浏览器接收到这个事件然后整个自动补全机器开始高速运转。取决于你的浏览器的算法或是是否打开隐私模式，各种建议将会呈现在地址栏下的提示框中。这些算法中的大多数根据搜索历史和书签对结果进行优先排序。

## 当你按下‘enter’键

为了从头说起，让我们选择在键盘上桥下enter键。在此节点，一个特定于enter键的回路关闭（直接或电容式）。这允许少量的电流流入键盘的逻辑电路，扫描每个按键开关的状态，同时消除开关快速间歇性关闭的电气噪声，并将其转换为按键代码的整数，在这个例子中为13。然后，键盘控制器对键码进行编码，以便传送到计算机上。现在几乎普遍是通过通用串行总线（USB）或蓝牙进行连接。

对于USB键盘来说：

- 产生的键码由内部键盘电路存储器储存在一个称为 "endpoint" 的寄存器中
- 主机 USB 控制器每隔10毫秒就会轮询该 "endpoint"，所以它能得到存储在上面的键码值
- 这个值会送到 USB SIE（串行接口引擎），以最大速度 1.5 Mb/s（USB 2.0）发送
- 然后这个串行信号在计算机的主机 USB 控制器处被解码，并由计算机的人机接口设备（HID）通用键盘设备驱动程序进行解释
- 之后键值被传入操作系统的硬件抽象层

对于触摸屏键盘来说：

- 当用户将手指放在现代电容式触摸屏上时，少量的电流会被转移到手指上。这通过导电层的静电场构成了电路，并在屏幕上的那个点产生了电压降。然后，屏幕控制器产生一个中断，报告 "点击" 的坐标
- 然后，移动操作系统将其 GUI 元素（现在是虚拟键盘应用按钮）中的一个点击事件通知当前的应用程序
- 虚拟键盘现在可以触发一个软件中断，用于向操作系统发送 "按键被按下" 的信息
- 这个中断通知当前的应用程序有一个 "按键被按下" 事件

## 解析url

现在游览器有了以下信息包含在URL中（Uniform Resource Locator 统一资源定位）：

- 协议“http”:使用超文本传输协议
- 资源 "/"：检索主（索引）页

当没有协议或可验证的主域名时，浏览器会把地址栏中的文本给到默认的搜索引擎

## DNS寻找

浏览器会尝试找出输入域名后的IP地址。寻找过程如下：

- **浏览器缓存**：浏览器会缓存DNS记录一段时间，有趣的时，操作系统不会告诉浏览器DNS记录的存活时间，所以浏览器会缓存一个固定时间（不同浏览器通常在2-30分之间）。
- **操作系统缓存**：如果浏览器没有缓存对应记录，浏览器会执行系统指令。操作系统有自己的缓存。
- **路由缓存**：请求来到路由器，他也有自己的缓存
- **ISP DNS缓存**：下一个地点时ISP的DNS服务器。
- **递归查询**：你的ISP的DNS服务器开始一个递归查询。从根名称服务器，通过 .com 顶级名称服务器，到谷歌的名称服务器。通常情况下，DNS 服务器在缓存中会有 .com 名称服务器的名称，因此，没有必要访问根名称服务器。

下图展示了一个递归查询的过程：
![递归查询](../../imgs/Example_of_an_iterative_DNS_resolver.svg)
